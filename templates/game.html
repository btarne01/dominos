{% extends "base.html" %}
{% block content %}
<h1>Round {{ current_round + 1 }}: {{ round_name }}</h1>

<h2>Current Standings</h2>
<table class="scores-table">
    <tr>
        <th>Player</th>
        <th>Total Score</th>
    </tr>
    {% for player in players %}
    <tr>
        <td>{{ player }}</td>
        <td>{{ scores[player] }}</td>
    </tr>
    {% endfor %}
</table>

<h2>Enter Round Results</h2>
<form method="POST" action="/submit_round">
    <div class="form-group">
        <label for="winner">Who went out first (winner)?</label>
        <select id="winner" name="winner" required onchange="updatePipInputs()">
            <option value="">Select winner...</option>
            {% for player in players %}
            <option value="{{ player }}">{{ player }}</option>
            {% endfor %}
        </select>
    </div>
    
    <div id="pip_inputs">
        <!-- Pip inputs will be generated by JavaScript -->
    </div>
    
    <button type="submit">Submit Round</button>
</form>

{% if game_history %}
<h2>Game History</h2>
<table class="scores-table">
    <tr>
        <th>Round</th>
        <th>Winner</th>
        <th>Scores</th>
    </tr>
    {% for round in game_history %}
    <tr>
        <td>{{ round.round_num }}: {{ round.round_name }}</td>
        <td class="winner">{{ round.winner }}</td>
        <td>
            {% for player, score in round.scores.items() %}
            {{ player }}: {{ score }}{% if not loop.last %}, {% endif %}
            {% endfor %}
        </td>
    </tr>
    {% endfor %}
</table>
{% endif %}

<script>
function updatePipInputs() {
    const winner = document.getElementById('winner').value;
    const container = document.getElementById('pip_inputs');
    container.innerHTML = '';
    
    if (winner) {
        const players = {{ players|tojson }};
        players.forEach(player => {
            if (player !== winner) {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.innerHTML = `
                    <label for="pips_${player}">${player}'s remaining pips:</label>
                    <input type="number" id="pips_${player}" name="pips_${player}" min="0" required>
                `;
                container.appendChild(div);
            }
        });
    }
}
</script>
{% endblock %}